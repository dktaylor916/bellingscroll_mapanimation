<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <script src = 'd3.js'></script>

    <script src = 'd3.min.js'></script>
    <script src = 'd3-legend.min.js'></script>
    <script src = 'd3-legend.js'></script>
<style>

#tooltip {
    position: absolute;
    display: none;
    background: rgba(0, 0, 0, .7);
    border-radius: 3px;
    box-shadow: -3px 3px 15px #939393;
    color: white;
    padding: 6px;
    font-family: "Merriweather";
    font-size: 1.1em;
    max-width: 400px;
    z-index: 100;
}


body {
    background-color: rgb(245, 244, 241);
    overflow-x: hidden;
}

#sections {
    position: relative;
    display: inline-block;
    width: 300px;
    top: 60px;
    z-index: 1;
    margin-right: 50px;
    opacity:1;
}

#circlelegend {
    position: absolute;
    display: inline-block;
    width: 300px;
    height:400px;
    top: 1400px;
    z-index: 99;
    margin-right: 50px;
    opacity:1;
}

#typelegend {
    position: absolute;
    display: inline-block;
    width: 300px;
    height:400px;
    top: 2000px;
    z-index: 99;
    margin-right: 50px;
    opacity:1;
}


.categoryLegend {
    font-family: "Domine";
}

.step {
    margin-bottom: 100px;
    height: 150px;
    font-family: "Domine";
    font-weight: 400;
    line-height: 1.4em;
    text-align: justify;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    
}

h1, h2 {
    font-weight: 700;
    text-align: right;
    line-height: 32px;
}

h1 {
    font-size: 35px;
}

strong {
    color: rgb(245, 155, 155);
}

#graphic {
    margin: auto;
    width: 1500px;
    flex-direction: row;
    align-items: top;
    justify-content: space-around;
}

#vis {
    display: inline-block;
    position: fixed;
    top: 0px;
    z-index: 1;
    margin-left: 0;
    height: 1000px;
    width: 1500px;
}

.tick line {
    stroke: 'red'
}


svg circle:hover{
    cursor: pointer;
}

.swatch {
    fill: #939393;
}

.sizeLegend2 {
    opacity: 0.7
}

a {
    color: rgb(221, 0, 255);
    text-decoration: none;
}

img {
    display: none;
}
#video {
position: absolute;
left:570px;
top:60px;
z-index: 10;
filter:opacity(80%);
}
</style>
</head>
<body>
    <div id='circlelegend'></div>
    <div id='typelegend'></div>
    <div id="tooltip"></div>
    <div id='video'>
    <video id="video1" width="320" autoplay muted loop>
        <source src="video.mp4">
        
        Your browser does not support HTML video.
      </video>
    </div>
  <div id="graphic">
    <div id="sections">
     <h1 style='text-align: center;'>Police Violence at US Protests</h1>
     INTRO. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus. Vivamus non lectus vel augue fermentum tristique ut eget felis. Phasellus ac dolor urna. Sed vel egestas neque. Cras fermentum erat a sem pellentesque interdum. Integer sagittis ullamcorper nisi et bibendum. Ut gravida pharetra lorem commodo congue. Etiam vitae elit rutrum, ullamcorper dui a, tempor mauris. Fusce tristique interdum velit, non mattis augue eleifend sit amet. Curabitur fermentum neque non diam molestie, vitae lacinia diam tempus. 
    
     
     <section class="step"></section>
     <h1 style='text-align: center;'>Total number of cases</h1>
         # of states, # of cities, other interesting things....Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus. Vivamus non lectus vel augue fermentum tristique ut eget felis. Phasellus ac dolor urna. Sed vel egestas neque. Cras fermentum erat a sem pellentesque interdum. Integer sagittis ullamcorper nisi et bibendum. Ut gravida pharetra lorem commodo congue. Etiam vitae elit rutrum, ullamcorper dui a, tempor mauris. Fusce tristique interdum velit, non mattis augue eleifend sit amet. Curabitur fermentum neque non diam molestie, vitae lacinia diam tempus. 
         <section class="step"></section>
         <h1 style='text-align: center;'>Cases concentrated in Portland, New York, LA</h1>
        <h2 style='text-align:left'>Top Five Cities</h2>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Portland, OR:      39 Cases<br><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;New York City, NY: 39 Cases<br><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Los Angeles, CA:   21 Cases<br><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Seattle, WA:       15 Cases<br><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Washington D.C.:   13 Cases<br><br>


         <section class="step"></section>
         <h1 style='text-align: center;'>Type of Violation Map</h1>
         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus.
        <br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Less Lethal Round<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Physical Assault<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tear Gas<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrest/Detention<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pepper Spray<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intimidation<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Killing<br><br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Other<br><br>
         <section class="step"></section>
         <h1 style='text-align: center;'>Grouping of Violations</h1>
         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus. Vivamus non lectus vel augue fermentum tristique ut eget felis. Phasellus ac dolor urna. Sed vel egestas neque. Cras fermentum erat a sem pellentesque interdum. Integer sagittis ullamcorper nisi et bibendum. Ut gravida pharetra lorem commodo congue. Etiam vitae elit rutrum, ullamcorper dui a, tempor mauris. Fusce tristique interdum velit, non mattis augue eleifend sit amet. Curabitur fermentum neque non diam molestie, vitae lacinia diam tempus. 
         <section class="step"></section>
         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus. Vivamus non lectus vel augue fermentum tristique ut eget felis. Phasellus ac dolor urna. Sed vel egestas neque. Cras fermentum erat a sem pellentesque interdum. Integer sagittis ullamcorper nisi et bibendum. Ut gravida pharetra lorem commodo congue. Etiam vitae elit rutrum, ullamcorper dui a, tempor mauris. Fusce tristique interdum velit, non mattis augue eleifend sit amet. Curabitur fermentum neque non diam molestie, vitae lacinia diam tempus. 
         <section class="step"></section>
         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo nulla ac nisi gravida lobortis. Aliquam et pulvinar lacus. Vivamus non lectus vel augue fermentum tristique ut eget felis. Phasellus ac dolor urna. Sed vel egestas neque. Cras fermentum erat a sem pellentesque interdum. Integer sagittis ullamcorper nisi et bibendum. Ut gravida pharetra lorem commodo congue. Etiam vitae elit rutrum, ullamcorper dui a, tempor mauris. Fusce tristique interdum velit, non mattis augue eleifend sit amet. Curabitur fermentum neque non diam molestie, vitae lacinia diam tempus. 
        </div>
    <div id="vis">
    
        
    </div>
</div>
   


<script>


/// CREATE MAP AND MARGINS ///


const w = 1100 
const h = 1000
var projection = d3.geoMercator().translate([(w/2) + 20,(h/2)-200]).center([-95.30,39.19]).scale(1000)

path = d3.geoPath().projection(projection)

var dataset;

var svg = d3.selectAll('#vis')
.append('svg')
.attr('width',w )
.attr('height', h)
.attr('opacity',1)



d3.json('us-states.geojson')
  .then(function(data) {
    svg.selectAll('path')
    .data(data.features)
    .enter()
    .append('path')
    .attr('d',path)
    .attr('opacity',.5)
    .attr('fill','#D6D6D6')
    .attr('stroke','black')


d3.csv('police_clean5.csv')
.then(function (data){
  var parseTime = d3.timeParse('%Y-%m-%d');
    data.forEach(function (d){
    d.date = parseTime(d.date)
    d.x =  +projection([+d.Longitude, +d.Latitude])[0]
    d.y = +projection([+d.Longitude, +d.Latitude])[1]
    dataset = data
  svg.selectAll('circle')
  .data(data)
  .enter()
  .append('circle')
  .attr('id','datacircle')
  .attr('class', function(d){
    return 'date'+ d.index

  })
  .attr('cx', function (d){return projection([+d.Longitude, +d.Latitude])[0]})
  .attr('cy', function (d){return projection([+d.Longitude, +d.Latitude])[1]})
  .attr('fill','red')
  .attr('r',15)
  .attr('stroke','yellow')
  .attr('stroke-width',4)
  .attr('opacity',0)
  })
  
  svg.append('text')
  .attr('x',w - 400)
  .attr('y',60)
  .attr('font-family','monospace')
  .attr('font-size','2.5em')
  .attr('font-weight',700)
  .attr('opacity',0)
  .text('HELLO')

window.onload = circleAnim();

function circleAnim(){

for (let yes = 0; yes < dataset.length;yes++){
 
  setTimeout(function(){
    if (activeIndex === 0) {
  d3.selectAll('.date'+String(yes))
  .raise()
  .transition()
  .attr('opacity',0)
  .transition()
  .duration(500)
  .attr('opacity',1)
  .attr('r',15)
  .attr('stroke','yellow')
  .attr('stroke-width',3)
  .transition()
  .duration(500)
  .attr('r',5)
  .attr('stroke','black')
  .attr('stroke-width',1)
  d3.selectAll('text')
  .transition()
  .attr('opacity',1)
  .text(String(dataset[yes].date).replace('00:00:00 GMT+0200 (Central European Summer Time)',''))
  

}
else {
  d3.selectAll('#datacircle')
  .transition()
  .attr('stroke','black')
  .attr('r',5)
  .attr('opacity',1)
  .attr('stroke-width',1)
  d3.selectAll('text')
  .transition()
  .attr('opacity',0)
  .text(String(dataset[348].date).replace('00:00:00 GMT+0200 (Central European Summer Time)',''))
  return
}
}
  

  ,40*yes)
}


}
svg.selectAll('#datacircle')
        .on('mouseover', mouseOver)
        .on('mouseout', mouseOut)

    function mouseOver(d, i){

        console.log('hi')
        d3.select(this)
            .transition('mouseover').duration(0)
            .attr('opacity', 1)
            .attr('stroke-width', 5)
            .attr('stroke', 'yellow')
            
        d3.select('#tooltip')
            .style('left', (d3.event.pageX + 10)+ 'px')
            .style('top', (d3.event.pageY - 25) + 'px')
            .style('display', 'inline-block')
            .html(`<strong>Date:</strong> ${d.date} 
                <br> <strong>City</strong> ${d.City} 
                <br> <strong>Type of Violation:</strong> ${d['Type of Violation']}
                <br> <strong>Hyperlink:</strong><a href='${d.Hyperlink}'</a>
                `)
    }
    
    function mouseOut(d, i){
        d3.select('#tooltip')
            .style('display', 'none')

        d3.select(this)
            .transition('mouseout').duration(0)
            .attr('opacity', 1)
            .attr('stroke-width', 1)
            .attr('stroke','black')
    }

var circleleg = d3.select('#circlelegend').append('svg').attr('height',300).attr('width',300).attr('opacity',1)

circleleg.append('circle')
.attr('id','circleleg')
.attr('class','leg1')
.attr('cx',20)
.attr('cy',62)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

circleleg.append('circle')
.attr('id','circleleg')
.attr('class','leg2')
.attr('cx',20)
.attr('cy',98)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

circleleg.append('circle')
.attr('id','circleleg')
.attr('class','leg3')
.attr('cx',20)
.attr('cy',134)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

circleleg.append('circle')
.attr('id','circleleg')
.attr('class','leg4')
.attr('cx',20)
.attr('cy',170)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

circleleg.append('circle')
.attr('id','circleleg')
.attr('class','leg5')
.attr('cx',20)
.attr('cy',206)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

var typeleg = d3.select('#typelegend').append('svg').attr('height',400).attr('width',400).attr('opacity',1)

typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg1')
.attr('cx',20)
.attr('cy',62)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg2')
.attr('cx',20)
.attr('cy',98)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg3')
.attr('cx',20)
.attr('cy',134)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg4')
.attr('cx',20)
.attr('cy',170)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')

typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg5')
.attr('cx',20)
.attr('cy',206)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')
typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg6')
.attr('cx',20)
.attr('cy',242)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')
typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg7')
.attr('cx',20)
.attr('cy',278)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')
typeleg.append('circle')
.attr('id','circleleg')
.attr('class','leg8')
.attr('cx',20)
.attr('cy',314)
.attr('fill','black')
.attr('r',10)
.attr('stroke','black')
})
})




function draw1(){
    d3.select('#vis').selectAll('path').transition().attr('opacity',.5)

    if (typeof simulation !== 'undefined'){simulation.stop()}
    d3.selectAll('#datacircle')
  .transition()
  .attr('opacity',1)
  .attr('r',5)
  .attr('stroke-width', 1)
  .attr('stroke','black')
  .attr('cx',function (d){return projection([+d.Longitude, +d.Latitude])[0]})
  .attr('cy',function (d){return projection([+d.Longitude, +d.Latitude])[1]})

  d3.selectAll('text')
  .transition()
  .attr('x',w - 400)
  .attr('y',60)
  .attr('font-family','monospace')
  .attr('font-size','2.5em')
  .attr('opacity',1)
  .text(String(dataset[348].date).replace('00:00:00 GMT+0200 (Central European Summer Time)',''))
  i=0


}



function draw2(){
    d3.select('#vis').selectAll('path').transition().attr('opacity',.5)
if (typeof simulation !== 'undefined'){simulation.stop()}
d3.selectAll('#datacircle')
  .transition()
  .attr('opacity',1)
  .attr('r',5)
  .attr('stroke','black')
  .attr('stroke-width', 1)
  .attr('cx',function (d){return projection([+d.Longitude, +d.Latitude])[0]})
  .attr('cy',function (d){return projection([+d.Longitude, +d.Latitude])[1]})
  .attr('fill','red')
  

  d3.select('#vis').selectAll('text')
  .transition()
  .attr('opacity',1)
  .attr('font-size','2em')
  .attr('x',w - 500)
  .attr('font-weight',700)
  .text('349 Cases, 34 States, 97 Cities')





}
function draw3(){
    d3.select('#vis').selectAll('text')
  .transition()
  .attr('opacity',0)


d3.select('#vis').selectAll('path').transition().attr('opacity',.5)
dataset.forEach(function(d){
    d.x =  +projection([+d.Longitude, +d.Latitude])[0]
    d.y = +projection([+d.Longitude, +d.Latitude])[1]
})
hex = ["#000000","#FFFF00","#1CE6FF","#FF34FF","#FF4A46","#008941","#006FA6","#A30059","#FFDBE5","#7A4900","#0000A6","#63FFAC","#B79762","#004D43","#8FB0FF","#997D87","#5A0007","#809693","#FEFFE6","#1B4400","#4FC601","#3B5DFF","#4A3B53","#FF2F80","#61615A","#BA0900","#6B7900","#00C2A0","#FFAA92","#FF90C9","#B903AA","#D16100","#DDEFFF","#000035","#7B4F4B","#A1C299","#300018","#0AA6D8","#013349","#00846F","#372101","#FFB500","#C2FFED","#A079BF","#CC0744","#C0B9B2","#C2FF99","#001E09","#00489C","#6F0062","#0CBD66","#EEC3FF","#456D75","#B77B68","#7A87A1","#788D66","#885578","#FAD09F","#FF8A9A","#D157A0","#BEC459","#456648","#0086ED","#886F4C","#34362D","#B4A8BD","#00A6AA","#452C2C","#636375","#A3C8C9","#FF913F","#938A81","#575329","#00FECF","#B05B6F","#8CD0FF","#3B9700","#04F757","#C8A1A1","#1E6E00","#7900D7","#A77500","#6367A9","#A05837","#6B002C","#772600","#D790FF","#9B9700","#549E79","#FFF69F","#201625","#72418F","#BC23FF","#99ADC0","#3A2465","#922329","#5B4534","#FDE8DC","#404E55","#0089A3","#CB7E98","#A4E804","#324E72","#6A3A4C","#83AB58","#001C1E","#D1F7CE","#004B28","#C8D0F6","#A3A489","#806C66","#222800","#BF5650","#E83000","#66796D","#DA007C","#FF1A59","#8ADBB4","#1E0200","#5B4E51","#C895C5","#320033","#FF6832","#66E1D3","#CFCDAC","#D0AC94","#7ED379","#012C58","#7A7BFF","#D68E01","#353339","#78AFA1","#FEB2C6","#75797C","#837393","#943A4D","#B5F4FF","#D2DCD5","#9556BD","#6A714A","#001325","#02525F","#0AA3F7","#E98176","#DBD5DD","#5EBCD1","#3D4F44","#7E6405","#02684E","#962B75","#8D8546","#9695C5","#E773CE","#D86A78","#3E89BE","#CA834E","#518A87","#5B113C","#55813B","#E704C4","#00005F","#A97399","#4B8160","#59738A","#FF5DA7","#F7C9BF","#643127","#513A01","#6B94AA","#51A058","#A45B02","#1D1702","#E20027","#E7AB63","#4C6001","#9C6966","#64547B","#97979E","#006A66","#391406","#F4D749","#0045D2","#006C31","#DDB6D0","#7C6571","#9FB2A4","#00D891","#15A08A","#BC65E9","#FFFFFE","#C6DC99","#203B3C","#671190","#6B3A64","#F5E1FF","#FFA0F2","#CCAA35","#374527","#8BB400","#797868","#C6005A","#3B000A","#C86240","#29607C","#402334","#7D5A44","#CCB87C","#B88183","#AA5199","#B5D6C3","#A38469","#9F94F0","#A74571","#B894A6","#71BB8C","#00B433","#789EC9","#6D80BA","#953F00","#5EFF03","#E4FFFC","#1BE177","#BCB1E5","#76912F","#003109","#0060CD","#D20096","#895563","#29201D","#5B3213","#A76F42","#89412E","#1A3A2A","#494B5A","#A88C85","#F4ABAA","#A3F3AB","#00C6C8","#EA8B66","#958A9F","#BDC9D2","#9FA064","#BE4700","#658188","#83A485","#453C23","#47675D","#3A3F00","#061203","#DFFB71","#868E7E","#98D058","#6C8F7D","#D7BFC2","#3C3E6E","#D83D66","#2F5D9B","#6C5E46","#D25B88","#5B656C","#00B57F","#545C46","#866097","#365D25","#252F99","#00CCFF","#674E60","#FC009C","#92896B"]

color = d3.scaleOrdinal().domain([0,97]).range(hex)

 simulation = d3.forceSimulation(dataset)

// Define each tick of simulation
simulation.on('tick', () => {
    svg
   .selectAll('#datacircle')
    .transition()
    .duration(250)
    .ease(d3.easeLinear)
    .attr('cx', d => d.x)
    .attr('cy', d => d.y)


})

nodes = svg
   .selectAll('#datacircle')

// Selection of all the circles 



// Define each tick of simulation

    simulation  
        
        .force('charge', d3.forceManyBody().strength([-2]))
        .force('forceX', d3.forceX(function (d){return projection([+d.Longitude, +d.Latitude])[0]}).strength(1))
        .force('forceY', d3.forceY(function (d){return projection([+d.Longitude, +d.Latitude])[1]}).strength(1))
        .force('collide', d3.forceCollide(11).strength(.9))
        .alphaDecay([0.25])

    //Reheat simulation and restart
    simulation.alpha(0.9).restart()

    d3.selectAll('path')
    .transition()
    .attr('opacity',.5)
    
    d3.selectAll('#datacircle')
    .attr('fill', function(d){ return color(d.cluster)})
    .attr('r', 10)
  


     setTimeout(function(){d3.selectAll('#datacircle').each(function(d){
         d.mapx = d3.select(this).attr('cx')
         d.mapy = d3.select(this).attr('cy')})},1200)

d3.select('.leg1')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d.City === 'Portland, OR, USA'
    }).attr('fill')
})

d3.select('.leg2')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d.City === 'New York City, NY, USA'
    }).attr('fill')
})

d3.select('.leg3')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d.City === 'Los Angeles, CA, USA'
    }).attr('fill')
})

d3.select('.leg4')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d.City === 'Seattle, WA, USA'
    }).attr('fill')
})

d3.select('.leg5')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d.City === 'Washington D.C., USA'
    }).attr('fill')
})

}
function draw4(){
    d3.select('#vis').selectAll('path').transition().attr('opacity',.5)

    violationcolor = d3.scaleOrdinal().domain(['Pepper Spray', 'Physical Assault', 'Less Lethal Round',
       'Tear Gas', 'Other', 'Intimidation', 'Arrest/Detention', 'Killing']).range(d3.schemeSet3)

   d3.selectAll('#datacircle')
   .transition()
   .duration(500)
.ease(d3.easeLinear)
   .attr('cx',function (d){return d.mapx})
   .attr('cy',function (d){return d.mapy} )
    .attr('fill',function (d){return violationcolor(d['Type of Violation'])})

setTimeout(function (){
    d3.selectAll('#typelegend').select('.leg1')
    .transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Less Lethal Round'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg2')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Physical Assault'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg3')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Tear Gas'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg4')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Arrest/Detention'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg5')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Pepper Spray'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg6')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Intimidation'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg7')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Killing'
    }).attr('fill')
})

d3.selectAll('#typelegend').select('.leg8')
.transition()
.attr('fill',function(){
    return d3.selectAll('#datacircle').filter(function (d){
        return d['Type of Violation'] === 'Other'
    }).attr('fill')
})}, 1000)

}


function draw5(){
   d3.select('#vis').selectAll('path').transition().attr('opacity',0)
    simulation = d3.forceSimulation(dataset)

// Define each tick of simulation
simulation.on('tick', () => {
    svg
   .selectAll('#datacircle')
    .transition()
    .duration(500)
    .ease(d3.easeLinear)
    .attr('cx', d => d.x)
    .attr('cy', d => d.y)


})

nodes = svg
   .selectAll('#datacircle')

// Selection of all the circles 



// Define each tick of simulation

    simulation  
        
        .force('charge', d3.forceManyBody().strength([1]))
        .force('forceX', d3.forceX(function (d){
            if(d['Type of Violation']=== 'Less Lethal Round'){
                return 100
            }
            if(d['Type of Violation']=== 'Physical Assault'){
                return 400
            }
            
            if(d['Type of Violation']=== 'Tear Gas'){
                return 700
            }
          
            if(d['Type of Violation']=== 'Arrest/Detention'){
                return 1000
            }
           
            if(d['Type of Violation']=== 'Pepper Spray'){
                return 100
            }
       
            if(d['Type of Violation']=== 'Intimidation'){
                return 400
            }
            if(d['Type of Violation']=== 'Killing'){
                return 700
            }
            if(d['Type of Violation']=== 'Other'){
                return 1000
            }
    
    
    
        }).strength([.99]))
        .force('forceY', d3.forceY(function (d){
            if(d['Type of Violation']=== 'Less Lethal Round'){
                return 200
            }
            if(d['Type of Violation']=== 'Physical Assault'){
                return 200
            }
            
            if(d['Type of Violation']=== 'Tear Gas'){
                return 200
            }
          
            if(d['Type of Violation']===  'Arrest/Detention'){
                return 200
            }
           
            if(d['Type of Violation']=== 'Pepper Spray'){
                return 500
            }
       
            if(d['Type of Violation']=== 'Intimidation'){
                return 500
            }
            if(d['Type of Violation']=== 'Killing'){
                return 500
            }
            if(d['Type of Violation']=== 'Other'){
                return 500
            }
    
    
    
        }).strength([.99]))
        .force('collide', d3.forceCollide(10.5).strength(.9))
        
        .alphaDecay([0.15])

    //Reheat simulation and restart
    simulation.alpha(0.9).restart()
}


let activationFunctions = [
    draw1,
    draw2,
    draw3,
    draw4,
    draw5
]

///SCOLLER!@#!@#@!#!@#@!#


let scroll = scroller()
    .container(d3.select('#graphic'))
scroll()

let lastIndex, activeIndex = 0

scroll.on('active', function(index){
    d3.selectAll('.step')
        .transition().duration(500)
        .attr('opacity', function (d, i) {return i === index ? 1 : 0.1;});
    
    activeIndex = index
    let sign = (activeIndex - lastIndex) < 0 ? -1 : 1; 
    let scrolledSections = d3.range(lastIndex + sign, activeIndex + sign, sign);
    scrolledSections.forEach(i => {
        activationFunctions[i]();
    })
    lastIndex = activeIndex;

})

scroll.on('progress', function(index, progress){
    if (index == 2 & progress > 0.7){

    }
})


function scroller(){
    let container = d3.select('body')
    let dispatch = d3.dispatch('active', 'progress');
    let sections = d3.selectAll('.step')
    let sectionPositions
   
    let currentIndex = -1
    let containerStart = 0;

    function scroll(){
        d3.select(window)
            .on('scroll.scroller', position)
            .on('resize.scroller', resize)

        resize();

        let timer = d3.timer(function() {
            position();
            timer.stop();
        });
    }

    function resize(){
        sectionPositions = [];
        let startPos;
    
        sections.each(function(d, i) {
            let top = this.getBoundingClientRect().top;
        
            if (i === 0 ){
                startPos = top;
            }
            sectionPositions.push(top - startPos)
        });
    }

    function position() {
        let pos = window.pageYOffset - 300 - containerStart;
        let sectionIndex = d3.bisect(sectionPositions, pos);
        sectionIndex = Math.min(sections.size()-1, sectionIndex);
    
        if (currentIndex !== sectionIndex){
            dispatch.call('active', this, sectionIndex);
            currentIndex = sectionIndex;
        }
    
        let prevIndex = Math.max(sectionIndex - 1, 0);
        let prevTop = sectionPositions[prevIndex]
        let progress = (pos - prevTop) / (sectionPositions[sectionIndex] - prevTop);
        dispatch.call('progress', this, currentIndex, progress)
    }

    scroll.container = function(value) {
        if (arguments.legth === 0){
            return container
        } 
        container = value 
        return scroll 
    }

    scroll.on = function(action, callback){
        dispatch.on(action, callback)
    };

    return scroll;
}





</script>
</body>
</html>

